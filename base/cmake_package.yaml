extends: [base_package]

dependencies:
  build: [cmake]

build_stages:

  - name: setup_builddir
    after: prologue
    handler: bash
    bash: |
      mkdir -p _build
      cd _build

  - when: platform == 'Darwin'
    name: fix_deployment_target
    after: prologue
    before: configure
    handler: bash
    bash: |
      unset MACOSX_DEPLOYMENT_TARGET

  - name: configure
    after: setup_builddir
    debug: {{debug}}

  - name: make
    after: configure
    handler: bash
    bash: |
      ${CMAKE} --build . -- -j ${HASHDIST_CPU_COUNT}

  - name: install
    after: make
    handler: bash
    bash: |
      make install

